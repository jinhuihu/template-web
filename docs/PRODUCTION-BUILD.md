# 生产环境构建指南

## 概述

本项目现在支持生产环境构建，会自动移除开发环境的热更新脚本，并对所有文件进行压缩和混淆优化。

## 构建命令

### 生产环境构建
```bash
pnpm run build
```

这个命令会：
1. 构建所有页面（从API获取数据并渲染模板）
2. 复制静态资源文件
3. **移除热更新脚本** - 自动删除HTML中的开发环境热更新代码
4. **压缩HTML文件** - 移除注释、空白字符，优化结构
5. **压缩JavaScript文件** - 混淆变量名，移除console语句，压缩代码
6. **压缩CSS文件** - 移除注释和空白字符

### 开发环境构建
```bash
pnpm run build:dev
```

这个命令会构建页面但保留热更新脚本，用于开发环境。

## 构建输出

构建完成后，`dist/` 目录将包含：

- **HTML文件**：已压缩，热更新脚本已移除
- **JavaScript文件**：已压缩和混淆
- **CSS文件**：已压缩

## 文件大小优化

生产环境构建会显著减少文件大小：

- HTML文件：移除所有空白字符、注释和热更新脚本
- JavaScript文件：变量名混淆、移除console语句、代码压缩
- CSS文件：移除注释和空白字符

## 注意事项

1. **API服务器**：生产环境构建需要API服务器运行（默认localhost:3001）
2. **热更新脚本**：生产环境构建会自动移除所有热更新相关代码
3. **文件压缩**：所有文件都会被压缩，建议在部署前测试功能是否正常

## 开发工作流

```bash
# 开发环境
pnpm run dev          # 启动开发服务器
pnpm run build:dev    # 开发环境构建（保留热更新）

# 生产环境
pnpm run build        # 生产环境构建（移除热更新，压缩文件）
```

## 技术实现

- **HTML压缩**：使用 `html-minifier-terser`
- **JavaScript压缩**：使用 `terser`
- **CSS压缩**：自定义压缩函数
- **热更新脚本移除**：正则表达式匹配和移除
