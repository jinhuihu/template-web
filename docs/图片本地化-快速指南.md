# 📷 图片本地化 - 快速指南

## ⚡ 功能说明

**生产构建时，自动下载HTML中的远程图片到本地，并替换URL。**

- ✅ 自动化处理
- ✅ 仅生产构建执行
- ✅ dev模式不影响

## 🚀 使用方法

### 1. 在模板中使用远程图片

```html
<!-- templates/index.html -->
<img src="https://cdn.example.com/banner.jpg" alt="Banner">

<div style="background-image: url('https://cdn.example.com/bg.png')">
  内容
</div>
```

### 2. 运行生产构建

```bash
npm run build
```

### 3. 自动处理

构建过程会：
- 检测远程图片URL
- 下载到 `dist/assets/images/[页面名]/`
- 替换HTML中的URL为本地路径

### 4. 查看结果

```bash
# 查看下载的图片
ls dist/assets/images/index/

# 查看替换后的HTML
cat dist/index.html | grep "img src"
```

## 📁 文件保存位置

```
dist/
  └── assets/
      └── images/
          ├── index/          ← index.html的图片
          ├── about/          ← about.html的图片
          ├── product/        ← product.html的图片
          └── image-test/     ← image-test.html的图片
```

## 📐 转换示例

| 原始URL | 本地路径 |
|---------|---------|
| `https://cdn.com/banner.jpg` | `assets/images/index/banner_abc123.jpg` |
| `https://img.com/photo.png` | `assets/images/about/photo_def456.png` |
| `https://api.com/image?id=1` | `assets/images/product/image_789ghi.jpg` |

## ⚙️ 支持的格式

### 图片标签

```html
<!-- ✅ 支持 -->
<img src="https://...">
<img src='https://...'>
```

### 背景图片

```html
<!-- ✅ 支持 -->
<div style="background-image: url('https://...')"></div>
<div style="background: url(https://...)"></div>
```

### 不处理的情况

```html
<!-- ❌ 本地路径，不处理 -->
<img src="assets/logo.png">
<img src="/static/image.jpg">
<img src="./photo.png">
```

## 🧪 测试页面

访问测试页面验证功能：

```bash
npm run build
npm run dev
open http://localhost:3000/image-test.html
```

## 📊 构建日志示例

```
处理HTML文件: dist/index.html
  检查图片URL...
  找到 3 个远程图片URL
  [1/3] 下载: https://cdn.example.com/banner.jpg
  ✓ 已保存: assets/images/index/banner_a1b2c3.jpg
  [2/3] 下载: https://cdn.example.com/logo.png
  ✓ 已保存: assets/images/index/logo_d4e5f6.png
  [3/3] 下载: https://cdn.example.com/product.jpg
  ✓ 已保存: assets/images/index/product_g7h8i9.jpg
  ✓ 已替换 3 个图片URL为本地路径
✓ HTML文件处理完成
```

## ⚠️ 注意事项

1. **dev模式不执行**
   - `npm run dev` 不会下载图片
   - 保持远程URL，快速开发

2. **下载失败处理**
   - 显示警告但不中断构建
   - 保留原始URL
   - 继续处理其他图片

3. **构建时间**
   - 图片下载会增加构建时间
   - 建议优化图片大小

4. **网络要求**
   - 需要能访问远程图片
   - 建议在网络良好时构建

## 💡 最佳实践

1. **开发时**：使用远程URL，快速迭代
2. **构建前**：确认图片URL有效
3. **构建后**：验证图片显示正常
4. **优化**：使用压缩过的图片

## 🎯 适用场景

✅ API返回的图片URL  
✅ CDN托管的图片  
✅ 第三方图片资源  
✅ 需要离线访问的页面  

---

**详细文档：** `docs/图片本地化功能.md`

**现在运行 `npm run build` 即可自动处理图片！** 🚀

