# 移动端适配 - 开发指南

## 🎯 快速开始

### 1. 引入适配方案

所有HTML页面的`<head>`中必须包含：

```html
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <!-- 1. 移动端适配脚本 - 必须最先加载 -->
  <script src="assets/js/flexible.js"></script>
  
  <!-- 2. 移动端适配样式 -->
  <link rel="stylesheet" href="assets/css/mobile-adapter.css">
  
  <!-- 3. 其他样式 -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>
```

**重要：** `flexible.js` 必须在所有样式之前加载！

### 2. 编写样式

使用rem单位，转换规则：

```
rem值 = 设计稿px值 ÷ 100
```

**示例：**

```css
/* 设计稿标注：宽度690px，高度200px，内边距30px，圆角16px */
.card {
  width: 6.9rem;        /* 690 ÷ 100 */
  height: 2rem;         /* 200 ÷ 100 */
  padding: 0.3rem;      /* 30 ÷ 100 */
  border-radius: 0.16rem; /* 16 ÷ 100 */
  background: white;
}
```

### 3. 字体使用px

```css
/* ✅ 推荐：字体使用px */
.title {
  font-size: 18px;      /* 不使用rem */
  line-height: 1.4;
  font-weight: bold;
}

.text {
  font-size: 14px;      /* 不使用rem */
  color: #666;
}
```

### 4. 边框使用px或hairline

```css
/* 普通边框：使用px */
.box {
  border: 1px solid #e5e5e5;
}

/* 0.5px边框：使用hairline类 */
<div class="box hairline"></div>
```

## 💻 实战示例

### 示例1：完整页面布局

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>首页</title>
  
  <script src="assets/js/flexible.js"></script>
  <link rel="stylesheet" href="assets/css/mobile-adapter.css">
  
  <style>
    /* 导航栏 */
    .navbar {
      height: 0.88rem;              /* 88px */
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0.02rem 0.08rem rgba(0, 0, 0, 0.08);
    }
    
    .navbar-title {
      font-size: 18px;              /* 字体用px */
      font-weight: bold;
      color: #333;
    }
    
    /* 内容区域 */
    .content {
      padding: 0.3rem;              /* 30px */
    }
    
    /* 卡片 */
    .card {
      width: 100%;
      padding: 0.3rem;              /* 30px */
      margin-bottom: 0.2rem;        /* 20px */
      background: white;
      border-radius: 0.16rem;       /* 16px */
      box-shadow: 0 0.02rem 0.08rem rgba(0, 0, 0, 0.08);
    }
    
    .card-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 0.16rem;       /* 16px */
    }
    
    .card-content {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }
    
    /* 底部操作栏 */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1rem;                 /* 100px */
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 -0.02rem 0.08rem rgba(0, 0, 0, 0.08);
      padding-bottom: env(safe-area-inset-bottom); /* 安全区域 */
    }
    
    .footer-button {
      width: 6.9rem;                /* 690px */
      height: 0.88rem;              /* 88px */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 0.08rem;       /* 8px */
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- 导航栏 -->
  <div class="navbar safe-area-top">
    <h1 class="navbar-title">页面标题</h1>
  </div>
  
  <!-- 内容 -->
  <div class="content">
    <div class="card">
      <h3 class="card-title">卡片标题</h3>
      <p class="card-content">卡片内容...</p>
    </div>
    
    <div class="card">
      <h3 class="card-title">卡片标题</h3>
      <p class="card-content">卡片内容...</p>
    </div>
  </div>
  
  <!-- 底部操作栏 -->
  <div class="footer">
    <button class="footer-button">确认</button>
  </div>
</body>
</html>
```

### 示例2：列表页面

```html
<style>
  .list {
    background: white;
  }
  
  .list-item {
    display: flex;
    align-items: center;
    padding: 0.3rem;              /* 30px */
    border-bottom: 1px solid #f0f0f0;
  }
  
  .list-item-icon {
    width: 0.8rem;                /* 80px */
    height: 0.8rem;               /* 80px */
    margin-right: 0.2rem;         /* 20px */
    border-radius: 50%;
    overflow: hidden;
  }
  
  .list-item-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .list-item-content {
    flex: 1;
  }
  
  .list-item-title {
    font-size: 15px;
    color: #333;
    margin-bottom: 0.08rem;       /* 8px */
  }
  
  .list-item-desc {
    font-size: 13px;
    color: #999;
  }
  
  .list-item-arrow {
    width: 0.12rem;               /* 12px */
    height: 0.12rem;              /* 12px */
    border-top: 2px solid #ccc;
    border-right: 2px solid #ccc;
    transform: rotate(45deg);
  }
</style>

<div class="list">
  <div class="list-item">
    <div class="list-item-icon">
      <img src="avatar.png" alt="">
    </div>
    <div class="list-item-content">
      <div class="list-item-title">标题文字</div>
      <div class="list-item-desc">描述文字</div>
    </div>
    <div class="list-item-arrow"></div>
  </div>
</div>
```

### 示例3：表单组件

```html
<style>
  .form-group {
    margin-bottom: 0.3rem;        /* 30px */
  }
  
  .form-label {
    display: block;
    font-size: 14px;
    color: #333;
    margin-bottom: 0.16rem;       /* 16px */
  }
  
  .form-input {
    width: 100%;
    height: 0.88rem;              /* 88px */
    padding: 0 0.3rem;            /* 30px */
    font-size: 15px;
    border: 1px solid #e5e5e5;
    border-radius: 0.08rem;       /* 8px */
    outline: none;
    transition: border-color 0.3s;
  }
  
  .form-input:focus {
    border-color: #667eea;
  }
  
  .form-input::placeholder {
    color: #ccc;
  }
  
  .form-button {
    width: 100%;
    height: 0.88rem;              /* 88px */
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    font-size: 16px;
    border: none;
    border-radius: 0.08rem;       /* 8px */
    cursor: pointer;
  }
  
  .form-button:active {
    opacity: 0.8;
  }
</style>

<form class="form">
  <div class="form-group">
    <label class="form-label">用户名</label>
    <input type="text" class="form-input" placeholder="请输入用户名">
  </div>
  
  <div class="form-group">
    <label class="form-label">密码</label>
    <input type="password" class="form-input" placeholder="请输入密码">
  </div>
  
  <button type="submit" class="form-button">登录</button>
</form>
```

## 🔧 开发工具配置

### VSCode 插件

1. **cssrem**
   ```json
   {
     "cssrem.rootFontSize": 100,
     "cssrem.fixedDigits": 2,
     "cssrem.autoRemovePrefixZero": false
   }
   ```

2. **px to rem**
   - 快捷键：Alt+Z
   - 自动转换选中的px值

### Chrome DevTools

开发者工具 → 切换设备模拟：
- iPhone SE (375×667)
- iPhone 12 Pro (390×844)
- iPad (768×1024)
- 自定义：750px

## 📊 性能优化

### 1. 图片优化

```html
<!-- 使用srcset提供多倍图 -->
<img srcset="image.png 1x, image@2x.png 2x, image@3x.png 3x"
     src="image@2x.png"
     alt="描述"
     style="width: 3rem; height: 2rem;">

<!-- 懒加载 -->
<img src="placeholder.png" 
     data-src="real-image@2x.png" 
     class="lazyload"
     style="width: 7.5rem;">
```

### 2. CSS性能

```css
/* ✅ 使用transform而不是position */
.animate {
  transform: translateX(1rem);
}

/* ❌ 避免 */
.animate {
  left: 1rem;
}

/* ✅ 使用will-change提示浏览器 */
.scroll-container {
  will-change: transform;
  -webkit-overflow-scrolling: touch;
}
```

### 3. 减少重绘

```css
/* 使用transform做动画 */
.slide {
  transform: translateX(0);
  transition: transform 0.3s;
}

.slide.active {
  transform: translateX(1rem);
}
```

## 🐛 调试技巧

### 1. 显示设备信息

在HTML上添加：

```html
<html data-debug="true">
```

会在右下角显示当前设备信息和fontSize。

### 2. 查看rem基准值

在浏览器console中：

```javascript
// 查看当前rem基准
console.log(document.documentElement.style.fontSize);

// 查看设备类型
console.log(document.documentElement.getAttribute('data-device'));

// 手动触发rem计算
window.flexible.setRemUnit();
```

### 3. 验证适配

```javascript
// 获取元素实际尺寸
const el = document.querySelector('.card');
console.log('宽度:', el.offsetWidth);
console.log('高度:', el.offsetHeight);

// 在不同设备上对比
// iPhone 6 (375px): 宽度应该约为345px (690/750*375)
// iPhone 12 (390px): 宽度应该约为358px (690/750*390)
```

## 📱 设备测试指南

### 测试矩阵

| 设备类型 | 测试设备 | 分辨率 | 测试重点 |
|---------|---------|--------|---------|
| 小屏手机 | iPhone SE | 375×667 | 内容是否完整显示 |
| 中屏手机 | iPhone 12 | 390×844 | 标准显示效果 |
| 大屏手机 | iPhone 14 Pro Max | 430×932 | 内容不过于分散 |
| 安卓 | 主流机型 | 360-420px | 兼容性 |
| PC | Chrome模拟器 | 750px | 模拟器效果 |

### 测试步骤

1. **启动开发服务器**
   ```bash
   npm run dev
   ```

2. **移动端测试**
   - 在手机浏览器打开 http://[your-ip]:3000
   - 检查布局、字体、交互

3. **PC端测试**
   - 在PC浏览器打开 http://localhost:3000
   - 检查模拟器显示
   - 验证750px容器效果

4. **Chrome DevTools测试**
   - F12 → 切换设备模拟
   - 测试不同分辨率
   - 检查响应式效果

## 🎨 常见布局模式

### 1. 全宽容器

```css
.full-width {
  width: 100%;
  padding: 0 0.3rem;    /* 左右留30px */
}
```

### 2. 固定宽度居中

```css
.fixed-width {
  width: 6.9rem;        /* 690px */
  margin: 0 auto;       /* 居中 */
}
```

### 3. 左右分栏

```css
.two-column {
  display: flex;
  gap: 0.2rem;          /* 间距20px */
}

.column {
  flex: 1;
  padding: 0.3rem;
}
```

### 4. 网格布局

```css
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.2rem;          /* 20px */
  padding: 0.3rem;
}

.grid-item {
  aspect-ratio: 1;      /* 正方形 */
  background: white;
  border-radius: 0.08rem;
}
```

### 5. 吸顶导航

```css
.sticky-nav {
  position: sticky;
  top: 0;
  height: 0.88rem;
  background: white;
  z-index: 100;
}
```

### 6. 底部固定操作栏

```css
.fixed-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1rem;                 /* 100px */
  background: white;
  padding: 0.3rem;
  padding-bottom: env(safe-area-inset-bottom);
  box-shadow: 0 -0.02rem 0.08rem rgba(0, 0, 0, 0.08);
}
```

## 🚀 高级技巧

### 1. 动态计算rem值

```javascript
// 在JS中使用rem
function pxToRem(px) {
  const baseFontSize = parseFloat(
    getComputedStyle(document.documentElement).fontSize
  );
  return px / baseFontSize;
}

// 使用
element.style.width = pxToRem(690) + 'rem'; // 6.9rem
```

### 2. 监听适配变化

```javascript
// 监听rem单位变化
window.addEventListener('remUnitChange', function(e) {
  console.log('设备类型:', e.detail.device);
  console.log('fontSize:', e.detail.fontSize);
  console.log('屏幕宽度:', e.detail.clientWidth);
  
  // 可以在这里做一些响应式处理
});
```

### 3. 条件渲染（移动/PC）

```javascript
const isMobile = document.documentElement.getAttribute('data-device') === 'mobile';

if (isMobile) {
  // 移动端特有逻辑
  console.log('移动端');
} else {
  // PC端特有逻辑
  console.log('PC端模拟器');
}
```

### 4. 横竖屏适配

```css
/* 竖屏 */
@media (orientation: portrait) {
  .landscape-only {
    display: none;
  }
}

/* 横屏 */
@media (orientation: landscape) {
  .portrait-only {
    display: none;
  }
}
```

```javascript
// 监听横竖屏变化
window.addEventListener('orientationchange', function() {
  console.log('屏幕方向变化');
  setTimeout(function() {
    window.flexible.setRemUnit();
  }, 300);
});
```

## ⚙️ flexible.js 配置

如需修改配置，编辑 `assets/js/flexible.js`：

```javascript
const config = {
  designWidth: 750,        // 设计稿宽度，默认750
  maxWidth: 750,           // 最大宽度（移动端）
  remBase: 100,            // rem基准值，默认100
  pcSimulator: true        // 是否启用PC端模拟器，默认true
};
```

### 禁用PC模拟器

如果不需要PC模拟器，修改：

```javascript
const config = {
  // ...
  pcSimulator: false  // 改为false
};
```

## 📦 构建和发布

### 构建命令

```bash
# 开发环境
npm run dev

# 生产构建
npm run build
```

### 检查构建结果

```bash
# 检查文件是否完整
ls -la dist/assets/js/flexible.js
ls -la dist/assets/css/mobile-adapter.css

# 验证HTML引入
grep "flexible.js" dist/index.html
grep "mobile-adapter.css" dist/index.html
```

## ✅ 代码审查要点

Review时检查：

1. **HTML结构**
   - [ ] 引入了 flexible.js
   - [ ] 引入了 mobile-adapter.css
   - [ ] viewport配置正确

2. **CSS样式**
   - [ ] 尺寸使用rem（除字体和边框）
   - [ ] 字体使用px
   - [ ] 边框使用px或hairline
   - [ ] 计算正确（设计稿÷100）

3. **响应式**
   - [ ] 考虑了不同屏幕宽度
   - [ ] 处理了安全区域
   - [ ] 测试了横竖屏

4. **性能**
   - [ ] 图片已优化
   - [ ] 使用了transform动画
   - [ ] 避免了大量重绘

## 🎯 团队协作流程

```
设计师 → 750px设计稿 → 标注文档
   ↓
前端开发 → 按规范转换rem → 编写代码
   ↓
自测 → 多设备测试 → 提交Review
   ↓
Code Review → 检查规范 → 合并代码
   ↓
联调测试 → 真机测试 → 发布上线
```

---

**严格遵循此开发指南，确保高质量的移动端体验！** 📱

